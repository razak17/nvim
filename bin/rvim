#!/bin/sh

export RVIM_PLUGINS_ENABLED='1'
export RVIM_LSP_ENABLED='1'
export RVIM_TREESITTER_ENABLED='1'
export RVIM_AI_ENABLED='1'
export RVIM_PLUGINS_MINIMAL='0'
export RVIM_NONE='0'
export RVIM_GHOST_ENABLED='0'

launch_nvim() {
	NVIM_APPNAME=rvim nvim "$@"
}

while [ "$#" -gt 0 ]; do
	arg=$1

	case "$arg" in
	--no-plugins)
		export RVIM_PLUGINS_ENABLED='0'
		shift
		;;
	--no-treesitter)
		export RVIM_TREESITTER_ENABLED='0'
		shift
		;;
	--no-lsp)
		export RVIM_LSP_ENABLED='0'
		shift
		;;
	--no-ai)
		export RVIM_AI_ENABLED='0'
		shift
		;;
	--minimal)
		export RVIM_PLUGINS_MINIMAL='1'
		shift
		;;
	--none)
		export RVIM_PLUGINS_ENABLED='0'
		export RVIM_LSP_ENABLED='0'
		export RVIM_NONE='1'
		shift
		;;
	--ghost)
		export RVIM_GHOST_ENABLED='1'
		shift
		;;

	*)
		launch_nvim "$@"
		exit 0
		;;
	esac
done

# ref: https://www.reddit.com/r/neovim/comments/15gihnd/neat_trick_for_restarting_neovim_fast_when_using/
while true; do
	launch_nvim "$@"
	if [ $? -ne 1 ]; then
		break
	fi
done
